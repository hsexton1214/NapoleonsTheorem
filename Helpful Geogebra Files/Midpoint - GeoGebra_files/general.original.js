$(document).ready(function($){$(".js-only").removeClass("js-only");$(".js-hide").hide();$("a.confirm").click(function(){return confirm(lang_confirm)});if($(".materials").length>0&&$("#general-search-term").val()==""&&!isMobileDevice()){$("#general-search-term").focus()}$("#cb_agree_license").change(function(){if($("#cb_agree_license:checked").length>=1){enableDownloadLinks(true)}else{enableDownloadLinks(false)}});window.GGBT_gen_edit.initShareOptionsButtons($(".material-list .decorator.shared.isowner, .material-list .meta-not-public-info.isowner"));$("#tabs li").click(function(e){var link=$("a",this);if(link.length&&link[0]!=e.target){e.preventDefault();window.location.href=link[0].href}});$(".message_announcement_close").click(function(){var id=$(this).parent().attr("id");id=id.substr(id.lastIndexOf("_")+1);$(this).parents(".message-box").hide();document.cookie="GeoGebraTubeA_"+id+"=1"});function enableDownloadLinks(enable){enableLinks($("#download_ggb"),enable);enableLinks($("#download_offline"),enable);enableLinks($("#download_scorm"),enable);enableLinks($("#download_scorm_tuturl"),enable);enableLinks($("#download_latex"),enable);enableLinks($("#download_ibook_online"),enable);enableLinks($("#download_ibook_lite"),enable);enableLinks($("#download_ibook_widget_lite_tuturl"),enable);enableLinks($("#download-popup .material-list-item a"),enable);if(enable){$("#download_list").removeAttr("disabled")}else{$("#download_list").attr("disabled","disabled")}}$("#user_info_show_more").click(function(){$(".user_data_more").toggle("fast");$(this).toggleClass("active")});function enableLinks(links,enable){if(links&&links.length){links.each(function(){var link=$(this);if(enable){link.removeClass("nounderline");link.attr("href",link.data("href"));link.removeAttr("disabled")}else{link.addClass("nounderline");link.data("href",link.attr("href"));link.removeAttr("href");link.attr("disabled","disabled")}})}}if(typeof license_agreed!="undefined"){$("#cb_agree_license").attr("checked",license_agreed);enableDownloadLinks(license_agreed)}$("#featured li").click(function(){window.location=$(this).find("h4 a").attr("href")});$("#featured li .overlay").click(function(event){event.stopPropagation();return true});$("select[name=taglanguage]").change(function(){var selectedlang=$(this).val();$.ajax({url:$(this).closest("form").attr("action"),type:"post",async:true,dataType:"html",data:"selectedlang="+encodeURIComponent(selectedlang)+"&textwritten="+encodeURIComponent("+"),success:function(result){$("textarea[name=predefined_tags]").val(result)},error:function(result){}})});$("input#tagsubmit").click(function(){var selectedlang=$("select[name=taglanguage]").val();var textwritten=$("textarea[name=predefined_tags]").val();$.ajax({url:$(this).closest("form").attr("action"),type:"post",async:true,dataType:"html",data:"selectedlang="+encodeURIComponent(selectedlang)+"&textwritten="+encodeURIComponent(textwritten),success:function(result){$("textarea[name=predefined_tags]").val(result)},error:function(result){}})});if($("#detect-size").length>0){$("#detect-size").change(function(){if($(this).is(":checked")){$("#applet-size").css("visibility","hidden")}else{$("#applet-size").css("visibility","visible")}})}if($("#appletsize_warning").length>0){function checkAppletSize(){var width=$("#width").val();var height=$("#height").val();if(width>900||height>600+102){$("#appletsize_warning").show(300)}else{$("#appletsize_warning").hide(300)}}checkAppletSize();$("#width").blur(function(){checkAppletSize()});$("#height").blur(function(){checkAppletSize()})}if($("#favorite").length>0){$("#favorite").click(function(){var button=$(this);$.get(button.attr("href")).success(function(result){if(result.type=="success"){if(result.newData){button.removeClass("icon-favorite");button.addClass("icon-is-favorite");gaTrackFavoriteMaterial("unfavorite",material_id)}else{button.removeClass("icon-is-favorite");button.addClass("icon-favorite");gaTrackFavoriteMaterial("favorite",material_id)}}});return false})}$("#tag_add").click(function(){if($("#tag_add_appear").css("display")=="none"){$("#tag_add_appear").css("display","block")}else{$("#tag_add_appear").css("display","none")}});$("#meta-more-link a").click(function(){$("#meta-more").slideDown();$("#meta-more-link").animate({opacity:"hide",height:"hide"},"fast");return false});$("#derivatives_more").click(function(){$(".derivative.js-hide").show(300);$(this).hide();return false});$("#tags_more").click(function(){$(".tag.js-hide").after("&nbsp;");$(".tag.js-hide").show(300);$(this).hide();return false});$(".collection_delete").click(function(){var answer=confirm(lang_confirm);if(answer){$.ajax({url:$(this).attr("href"),type:"post",async:true,dataType:"html",success:function(result){location.reload()},error:function(result){location.reload()}})}return false});$(".simplemodal-close-hack").click(function(){location.reload();return false});$("#collection-add").click(function(){var source=$(this);$("#collection-manage-dialog").modal({escClose:true,overlayClose:true,focus:true,opacity:20,onOpen:function(dialog){dialog.data.show();dialog.container.show();dialog.overlay.show();$("#collection-manage-dialog").addClass("ajax-load");$.get(source.attr("href"),"",function(data){$("#collection-manage-dialog").removeClass("ajax-load");$("#collection-manage-dialog-content").html(data);function toggleChapterList(listItem){if($('input[type="checkbox"]',listItem).is(":checked")){$(".collection_add_list_chapter",listItem).show("fast")}else{$(".collection_add_list_chapter",listItem).hide("fast")}}function saveBookAssignemnt(listItem){var url=listItem.data("url");var chapter_id=$(".collection_add_list_chapter select",listItem).val();if(chapter_id!=undefined&&chapter_id!=0){url+="/chapter_id/"+chapter_id}url+="/add/"+($('input[type="checkbox"]',listItem).is(":checked")?"true":"false");$.get(url,"",function(data){if(data!="success"){$('input[type="checkbox"]',listItem).attr("checked",!$('input[type="checkbox"]',listItem).is(":checked"));toggleChapterList(listItem)}})}$('input[type="checkbox"]',"#collection-manage-dialog-content").change(function(){var source=$(this).parent();toggleChapterList(source);saveBookAssignemnt(source)});$(".collection_add_list_chapter select").change(function(){saveBookAssignemnt($(this).parent().parent())})})},onClose:function(dialog){dialog.data.hide();dialog.container.hide();dialog.overlay.hide();$.modal.close()}});return false});$("#join_group").on("click",function(e){e.preventDefault();window.GGBT_gen_modal.showAjaxPopup("/group/join",{},{className:"group_join_popup",maxWidth:"300"},$(this).data("popup-title"),null,function(){$("#joingroup").on("click",function(e){var code=$("#code").val();if(code){$.get("/group/join",{code:code}).done(function(e){if(e.type==="success"&&e.newData){window.location=e.newData}else{window.alert(e.message)}})}})})});$(".reply").click(function(){var source=$(this);var id=source.attr("href").substring("#comment-".length);var reply_form=$("#comment-reply");var wasHidden=reply_form.css("display")=="none";var report_form=$("#comment-report");var wasHiddenReport=report_form.css("display")=="none";if(wasHidden||$("#reply_to").val()!=id){var original=$(source.attr("href")+" > .children");var original_haschildren=true;if(original.length==0){original_haschildren=false;original=$(source.attr("href"))}reply_form.find("textarea").val("");if(!wasHiddenReport){report_form.hide(200)}if(!wasHidden){reply_form.hide(200,function(){if(original_haschildren){original.prepend(reply_form)}else{original.append(reply_form)}reply_form.show(400,function(){this.scrollIntoView(false)})})}else{if(original_haschildren){original.prepend(reply_form)}else{original.append(reply_form)}reply_form.show(400,function(){this.scrollIntoView(false)})}$("#reply_to").val(id)}return false});$(".report_button").click(function(){var source=$(this);var id=source.attr("href").substring("#comment-".length);var report_form=$("#comment-report");var wasHidden=report_form.css("display")=="none";var reply_form=$("#comment-reply");var wasHiddenReply=reply_form.css("display")=="none";if(wasHidden||$("#report_which").val()!=id){var original=$(source.attr("href")+" > .children");var original_haschildren=true;if(original.length==0){original_haschildren=false;original=$(source.attr("href"))}report_form.find("textarea").val("");if(!wasHiddenReply){reply_form.hide(200)}if(!wasHidden){report_form.hide(200,function(){if(original_haschildren){original.prepend(report_form)}else{original.append(report_form)}report_form.show(400,function(){this.scrollIntoView(false)})})}else{if(original_haschildren){original.prepend(report_form)}else{original.append(report_form)}report_form.show(400,function(){this.scrollIntoView(false)})}$("#report_which").val(id)}return false});$("#reply-remove").click(function(){$("#comment-reply").hide(200);$("#reply_to").val("0")});var commentEditForm;$(".comment-edit").click(function(){var source=$(this);var commentContainer=source.parentsUntil(".comment").parent();if(commentEditForm!=null&&commentEditForm.parentsUntil(".comment").parent().attr("id")==commentContainer.attr("id")){commentEditForm.hide(200);commentEditForm=null}else{$.get(source.attr("href"),function(result){if(commentEditForm!=null){commentEditForm.hide();commentEditForm=null}commentContainer.find(".text:first").after(result);addFormattingOptions(commentContainer.find("#comment-edit-form"));commentEditForm=commentContainer.find("#comment-edit-form")})}return false});window.GGBT_gen_gui.initFollowersButton();$(".pagination li").click(function(){var link=$("a",this)[0];if(link!=undefined)link.click()});$("#report-remove").click(function(){$("#report_which").val("0");$(this).parents(".report_form").hide(200)});$("#comment-report-remove").click(function(){$("#comment-report").hide(200)});$("#comment-report").submit(function(){$.ajax({url:$("#comment-report").attr("action"),type:"post",async:true,dataType:"html",data:$("#comment-report").serialize(),success:function(result){if(result=="success"){$("#comment-report").before($("#report-message"));$("#report-message").fadeIn().delay(2e3).fadeOut("slow")}else if(result=="error_15seconds"){$("#comment-report").before($("#report-message-15"));$("#report-message-15").fadeIn().delay(2e3).fadeOut("slow")}else{$("#comment-report").before($("#report-message-fail"));$("#report-message-fail").fadeIn().delay(2e3).fadeOut("slow")}$("#comment-report").hide(200);$("#report_which").val("0")},error:function(result){$("#comment-report").before($("#report-message-fail"));$("#report-message-fail").fadeIn().delay(2e3).fadeOut("slow")}});return false});$(".report_button_main").click(function(){var source=$(this);var id=source.attr("href").substring(1);var form_id=source.attr("data-formid");var report_form=$("#"+form_id);report_form.find("textarea").val("");report_form.toggle(200);return false});$(".report_form").submit(function(){var form=$(this);$.ajax({url:form.attr("action"),type:"post",async:true,dataType:"html",data:form.serialize(),success:function(result){if(result=="success"){form.before($("#report-message"));$("#report-message").fadeIn().delay(2e3).fadeOut("slow")}else if(result=="error_15seconds"){form.before($("#report-message-15"));$("#report-message-15").fadeIn().delay(2e3).fadeOut("slow")}else{form.before($("#report-message-fail"));$("#report-message-fail").fadeIn().delay(2e3).fadeOut("slow")}form.hide(200)},error:function(result){form.before($("#report-message-fail"));$("#report-message-fail").fadeIn().delay(2e3).fadeOut("slow")}});return false});function likeMaterial(source,url){$.get(url,function(data){if(data.status=="success"){var preLikes=parseInt(source.html());source.html(data.stats.likes);var action="like";if(preLikes>data.stats.likes)action="unlike";gaTrackLikeMaterial(action,material_id)}},"json")}$("#like").click(function(){likeMaterial($("#likes"),$(this).attr("href"));return false});$(".meta-community .likes.click").click(function(){likeMaterial($(this),$(this).data("url"));return false});$("input[name=manage_all1]").mousedown(function(){if($(this).is(":checked")){$(".mccheck").attr("checked",false);$("input[name=manage_all2]").attr("checked",false)}else{$(".mccheck").attr("checked",true);$("input[name=manage_all2]").attr("checked",true)}});$("input[name=manage_all2]").mousedown(function(){if($(this).is(":checked")){$(".mccheck").attr("checked",false);$("input[name=manage_all1]").attr("checked",false)}else{$(".mccheck").attr("checked",true);$("input[name=manage_all1]").attr("checked",true)}});$("input[name=submit1]").submit(function(){return false});$("input[name=submit2]").submit(function(){return false});$("select[name=report_select1]").change(function(){$("select[name=report_select2]").val($("select[name=report_select1]").val())});$("select[name=report_select2]").change(function(){$("select[name=report_select1]").val($("select[name=report_select2]").val())});$(".report_message_query_link").click(function(){var entryid=$(this).attr("href").substring(1);var container=$("#comment_for_"+entryid);if(container.data("loaded")==true){if(container.css("display")=="none"){container.css("display","block")}else{container.css("display","none")}}else{$.ajax({url:$("#report_manage_url").val(),type:"post",async:true,dataType:"html",data:"entry="+encodeURIComponent(entryid),success:function(result){container.html(result);container.css("display","block");container.data("loaded",true)},error:function(result){alert("Ajax error")}})}return false});if(typeof url_tagsuggest!=="undefined"){if($("#tags").length>0){$("#tags").tagSuggest({url:url_tagsuggest,delay:2})}}var setToggleMaterialsFirstLoad=true;$("#collection-toggle-materials").click(function(){var container=$("#collection-bar-materials");if(container.css("display")=="block"){container.hide(400)}else{if(setToggleMaterialsFirstLoad){$.ajax({url:$(this).attr("href"),type:"post",async:true,dataType:"html",success:function(result){container.html(result);container.find("li a").mouseenter(function(){$("#collection-bar-materials-info").append($(this).parent().find("div").clone())});container.find("li a").mouseout(function(){$("#collection-bar-materials-info").empty()});container.show(400);setToggleMaterialsFirstLoad=false}})}else{container.show(400)}}return false})});function isMobileDevice(){if(window.innerWidth<=768){return true}else{return false}}window.GGBT_gen_gui=function($){"use strict";function initFollowersButton(){var followuser=$("#following_user").on("click",function(e){var id=$(this).data("id"),act=$(this).data("act"),t=$(this);if(id){$.post("/user/followers/",{id:id,act:act}).done(function(data){var followers;if(data.action==="add"){t.find("span").text(t.data("unfollow")).end().data("act","del");window.GGBT_gen_msg.msg(t.data("follow_confirm"))}else if(data.action==="del"){t.find("span").text(t.data("follow")).end().data("act","add");window.GGBT_gen_msg.msg(t.data("unfollow_confirm"))}if(data.followers&&data.followers.length){followers=data.followers.length}else{followers=0}window.GGBT_gen_gui.updateFollowersBadge(followers);if(window.GGBT_livefollowers){window.GGBT_livefollowers.updateFollowers(id,followers)}}).error(function(e){alert(e)})}}).on("mouseover",function(){if($(this).data("act")==="del"){$(this).find("span").text($(this).data("unfollow"));$(this).find("span").removeClass("icon-follow");$(this).find("span").addClass("icon-no-follow")}}).on("mouseout",function(){if($(this).data("act")==="del"){$(this).find("span").text($(this).data("following"));$(this).find("span").removeClass("icon-no-follow");$(this).find("span").addClass("icon-follow")}}).data("followuser");if(followuser){$("#following_user").trigger("click")}}function updateFollowersBadge(followers){if(followers){$("#badge-followers").show();$("#badge-followers-count").text(followers);if(followers===1){$("#badge-followers-text").text($("#badge-followers-text").data("badge_follower"))}else{$("#badge-followers-text").text($("#badge-followers-text").data("badge_followers"))}}else{$("#badge-followers").hide()}}function getBaseURL(){return window.location.protocol+"//"+window.location.host}return{updateFollowersBadge:updateFollowersBadge,getBaseURL:getBaseURL,initFollowersButton:initFollowersButton}}(jQuery);window.GGBT_gen_modal=function($){"use strict";var storedOptions,defaults,dlg;function showPopup(dlgElem,options,title,onOpenFct,onCloseFct){if($("#ggt-popup-wrapper").length===1){$("body").append($('<div id="ggt-popup-stored"></div>').append($("#ggt-popup-header")).append($("#ggt-popup-content")));$("#ggt-popup-header").attr("id","ggt-popup-header-stored");$("#ggt-popup-content").attr("id","ggt-popup-content-stored");storedOptions=$.extend(true,{},$.modal.getOptions());$.modal.close();var oriOnClose=options.onClose;options.onClose=function(){if(typeof oriOnClose=="function"){oriOnClose.onClose()}$.modal.close();if($("#ggt-popup-stored").length==1){var storedDlg=$("#ggt-popup-stored").detach();storedDlg.attr("id","ggt-popup-wrapper");$("#ggt-popup-header-stored",storedDlg).attr("id","ggt-popup-header");$("#ggt-popup-content-stored",storedDlg).attr("id","ggt-popup-content");storedDlg.modal(storedOptions);$("#ggt-popup").show();$("#ggt-popup-wrapper").show()}}}var o={onOpen:function(dialog){if(typeof dlgElem!="string"){dlgElem.show()}dialog.data.show();dialog.container.show();dialog.overlay.show();$("body").css("top",-$(window).scrollTop()+"px").addClass("noscroll");if(typeof onOpenFct==="function"){onOpenFct()}},onClose:function(dialog){dialog.data.hide();dialog.container.hide();dialog.overlay.hide();$.modal.close();var pos=$("body").position();$("body").removeClass("noscroll");$(window).scrollTop(pos.top*-1);if(typeof dlgElem!="string"){dlgElem.hide();if(dlgElem.has("iframe")){dlgElem.find("iframe").remove()}dlgElem.appendTo("body")}if(typeof onCloseFct==="function"){onCloseFct()}},escClose:true,overlayClose:true,focus:true,opacity:70,overlayId:"ggt-popup-overlay",containerId:"ggt-popup",autoPosition:true,autoResize:true,closebutton:true,minHeight:undefined};if(options!==null&&typeof options==="object"){if(options.minHeight){options.minHeight+=30}o=$.extend({},o,options)}var header=$('<div id="ggt-popup-header"></div>').prepend('<a class="ggt-popup-close"></a>');if(title!==null&&title!==undefined){header.prepend("<h5>"+title+"</h5>")}var content=$('<div id="ggt-popup-content"></div>').prepend(dlgElem);dlg=$('<div id="ggt-popup-wrapper"></div>').append(header).append(content);if(defaults&&defaults.button_close&&o.closebutton){getPopupFooter()}return dlg.modal(o)}function setSize(height,width){if(height!==undefined){$("#ggt-popup-iframe").height(height);height+=$("#ggt-popup-header").height()+3;if($.modal.minHeight()>height){$.modal.minHeight(height)}}if(width!==undefined){$("#ggt-popup-iframe").width(width)}$.modal.update(height,width)}function title(newTitle){if(newTitle!==undefined&&newTitle!==null){$("#ggt-popup-header h5").html(newTitle)}else{return $("#ggt-popup-header h5").html()}}function showAjaxPopup(url,postParams,options,title,onOpenFct,onSuccessFct,contentWrapper){var o={onOpen:function(dialog){dialog.overlay.show();$("#ggt-popup").hide();$("body").css("top",-$(window).scrollTop()+"px").addClass("noscroll");if(typeof onOpenFct==="function"){onOpenFct()}}};if(typeof options=="object"){o=$.extend({},o,options)}var dlg=showPopup("Loading ...",o,title,onOpenFct);var fail=function(error){var message=typeof error.responseText!="undefined"?error.responseText:error.message;$("#ggt-popup-content").html("<h4>Error: "+message+"</h4>");$.modal.update($("#ggt-popup-content").height());$("#ggt-popup").show()};var onReceive=function(data){var html;if(typeof data=="object"){if(data.type=="success"){html=data.newData}else{fail(data)}}else{html=data}if(html!==undefined){if(contentWrapper!==undefined){contentWrapper.append(html);html=contentWrapper.html()}$("#ggt-popup-content").html(html);$("#ggt-popup").show();$.modal.update();if(typeof onSuccessFct==="function"){onSuccessFct()}}};var always=function(){$("body").removeClass("ajax-load")};$("body").addClass("ajax-load");if(postParams!=null){$.post(url,postParams,onReceive).fail(fail).always(always)}else{$.get(url,onReceive).fail(fail).always(always)}return dlg}function showYesNoPopup(message,yesFct,noFct,yesText,noText,cancelText){var yesBtn=$('<button class="button" id="popup-btn-yes">'+yesText+"</button>");yesBtn.click(function(){$.modal.close();if(yesFct!==null){yesFct()}});var noBtn=$('<a id="popup-btn-no">'+noText+"</a>");noBtn.click(function(){$.modal.close();if(noFct!==null){noFct()}});var buttons=yesBtn.add(noBtn);if(cancelText!==null&&cancelText!==undefined){var cancelBtn=$('<button class="button" id="popup-btn-cancel">'+cancelText+"</button>");cancelBtn.click(function(){$.modal.close()});buttons=buttons.add(cancelBtn)}return showMessagePopup(message,buttons,false,null,true)}function showMessagePopup(message,buttons,showOKButton,okText,noCloseIcon){var popup=$('<div id="popup-yesno" class="message-dialog">');popup.append('<div class="message-text">').text(message);popup.append("<br/><br/>");var buttonBar=$('<span class="button-bar">').appendTo(popup);if(buttons===null||showOKButton){var okBtn=$('<button class="button" id="popup-btn-ok">'+okText+"</button>").appendTo(buttonBar);okBtn.click(function(){$.modal.close()})}if(buttons!==null){buttons.appendTo(buttonBar)}var ret=showPopup(popup,{closebutton:false,close:noCloseIcon?false:true});var width=popup.width();if(width>$(window).width()-80){width=$(window).width()-80}setSize(undefined,width);if(noCloseIcon){$(".modalCloseImg").hide()}return ret}var iFrameSuccessFct;function showIframePopup(url,options,title,onOpenFct,onSuccessFct,onCloseFct){iFrameSuccessFct=onSuccessFct;var o={autoResize:true,onOpen:function(dialog){dialog.overlay.show();$("#ggt-popup").hide();$("body").css("top",-$(window).scrollTop()+"px").addClass("noscroll");if(typeof onOpenFct==="function"){onOpenFct()}}};if(typeof options=="object"){o=$.extend({},o,options)}window.GGBT_gen_modal.onLoadIframe=function(){$("#ggt-popup").show();$("body").removeClass("ajax-load");$.modal.update();$("#ggt-popup-iframe").width($("#ggt-popup .simplemodal-wrap").width());$("#ggt-popup-iframe").height($("#ggt-popup .simplemodal-wrap").height()-$("#ggt-popup-header").height()-3);if(typeof iFrameSuccessFct==="function"){iFrameSuccessFct()}$("#ggt-popup").find(".simplemodal-wrap").css({overflow:"hidden"});window.GGBT_gen_modal.onLoadIframe=undefined};var iframe='<iframe id="ggt-popup-iframe" frameborder="0" src="'+url+'" title="'+title+'" onload="window.GGBT_gen_modal.onLoadIframe()"/>';$("body").addClass("ajax-load");return showPopup(iframe,o,title,onOpenFct,onCloseFct)}function showSearchPopup(url,postParams,options,title,onOpenFct,collection_add_function){var header,input,collection_search_scrollstep=0,collection_search_ison=false,collection_search_next=null;var o={autoResize:false,minHeight:500};if(typeof options=="object"){o=$.extend({},o,options)}var params={keyword:"",step:collection_search_scrollstep};if(typeof postParams=="object"){params=$.extend({},params,postParams)}function listLoaded(){if(typeof collection_add_function==="function"){collection_add_function()}}var onFirstLoad=function(result){listLoaded();$("#ggt-popup-search-results").scroll(function(){if($("#coll-addlist-loading").length>0&&visible_in_container(this,$("#coll-addlist-loading")[0])){if(!collection_search_ison){collection_search_scrollstep+=1;collectionAjaxSearch($("#collection_search").val())}}})};var onAddLoad=function(result){var resultWrapper=$("#ggt-popup-search-results");$("#coll-addlist-loading").remove();if(collection_search_scrollstep===0){resultWrapper.empty();resultWrapper.append(result);resultWrapper.scrollTop(0)}else{resultWrapper.append(result)}console.log($(".collection_add").length);listLoaded();if(collection_search_next===null){collection_search_ison=false}else{var nextreq=collection_search_next;collection_search_next=null;collectionAjaxSearch(nextreq)}};function collectionAjaxSearch(keywordval){collection_search_ison=true;params.keyword=keywordval;params.step=collection_search_scrollstep;$.ajax({url:url,type:"post",async:true,dataType:"html",data:params,success:onAddLoad,error:function(result){if(collection_search_next===null){collection_search_ison=false}else{var nextreq=collection_search_next;collection_search_next=null;collectionAjaxSearch(nextreq)}}})}function visible_in_container(p,e){var z=p.getBoundingClientRect();var r=e.getBoundingClientRect();return!(r.top>z.bottom||r.bottom<z.top||r.left>z.right||r.right<z.left)}var resultWrapper=$('<div id="ggt-popup-search-results"/>');showAjaxPopup(url,params,o,title,onOpenFct,onFirstLoad,resultWrapper);header=$("#ggt-popup-header");input=$('<input id="ggt-popup-search" placeholder="'+o.searchplaceholder+'" />');header.prepend(input);input.keyup(function(){collection_search_scrollstep=0;if(collection_search_ison){collection_search_next=$(this).val()}else{collectionAjaxSearch($(this).val())}})}var popupParent;function pushPopup(dlgElem,options,title,onOpenFct){if(typeof dlgElem==="object"){dlgElem=dlgElem instanceof $?dlgElem:$(dlgElem);popupParent=dlgElem.parent()}else{popupParent=undefined}$("#ggt-popup-content").attr("id","ggt-popup-oldcontent");$("#ggt-popup-oldcontent").hide();$("#ggt-popup-oldcontent").data("title",this.title());var newContent=$('<div id="ggt-popup-content"></div>').prepend(dlgElem);var dlg=$("#ggt-popup-wrapper").append(newContent);$(dlgElem).show();this.title(title);setSize(newContent.height(),newContent.width())}function closePopup(){if($("#ggt-popup-oldcontent").length==1){var oldDlg=$("#ggt-popup-content").children().first();var newDlg=$("#ggt-popup-oldcontent").children().first();if(popupParent!==undefined){popupParent.append(oldDlg);oldDlg.hide()}$("#ggt-popup-content").remove();$("#ggt-popup-oldcontent").attr("id","ggt-popup-content");this.title($("#ggt-popup-content").data("title"));$("#ggt-popup-content").show();setSize(newDlg.height(),newDlg.width())}else{$.modal.close()}}var cache={dom:null,scrollTop:null};function replacePopupContent(u,conf){var data=conf&&conf.data||{},onLoad=conf&&conf.onLoad,json=conf&&conf.json,url=u;if(conf.selectorToCache){cache.scrollTop=$(conf.selectorToCache).scrollTop();cache.dom=$(conf.selectorToCache).detach()}if(url!==null){if(json){url+="/json/true"}$.ajax({type:"POST",url:url,data:data,dataType:json?"json":"html"}).done(function(result){if(!json){$("#ggt-popup-content").html(result)}if(typeof onLoad==="function"){onLoad(json?result:undefined)}}).fail(function(){alert("operation was wrong")}).always(function(){console.log("replacecontent finished")})}else if(conf){if(conf.fromCache){var dom=$("#ggt-popup-content").empty().append(cache.dom);if(cache.scrollTop){cache.dom.scrollTop(cache.scrollTop);cache.dom=null;cache.scrollTop=null}}else if(conf.html){$("#ggt-popup-content").html(conf.html)}else if(conf.jq){$("#ggt-popup-content").append(conf.jq)}}}function emptyPopupContent(){$("#ggt-popup-content").empty()}var footer=null;function getPopupFooter(){var footerText=$('<span id="popup-msg"></span>'),a;if(footer===null){footer=$('<div id="ggt-popup-footer"></div>').appendTo(dlg);footer.append(footerText);if(defaults&&defaults.button_close){var a=$('<a id="popup-button-close" class="button" title="'+defaults.button_close+'">'+defaults.button_close+"</a>");footer.append(a)}}else if(dlg){dlg.append(footer)}dlg.on("click","#popup-button-close",function(e){e.preventDefault();closePopup()});return footer}function showPopupFooterMessage(msg){getPopupFooter().find("#popup-msg").text(msg).fadeIn("fast",function(){getPopupFooter().find("#popup-msg").fadeOut(3e3)})}function setDefaults(defs){defaults=defs}function setCookie(cname,cvalue,exSeconds){var d=new Date;d.setTime(d.getTime()+exSeconds*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"; "+expires+"; path=/"}function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1)}if(c.indexOf(name)===0){return c.substring(name.length,c.length)}}return""}function showPdfPopup(src,title){var width=Math.min($(window).width()-100,1e3);var height=$(window).height()-130;if(title===undefined||title===""){title="&nbsp;"}var pdf=$('<div style="width:'+width+"px; height:"+height+'px;"><iframe src="'+src+'" width="100%" height="100%"></iframe></div>');window.GGBT_gen_modal.showPopup(pdf,{autoResize:true,closebutton:false},title);$(window).trigger("resize");window.GGBT_gen_modal.setSize(height,width)}return{showPopup:showPopup,showPopupFooterMessage:showPopupFooterMessage,showAjaxPopup:showAjaxPopup,showSearchPopup:showSearchPopup,showYesNoPopup:showYesNoPopup,showPdfPopup:showPdfPopup,replacePopupContent:replacePopupContent,emptyPopupContent:emptyPopupContent,showIframePopup:showIframePopup,showMessagePopup:showMessagePopup,closePopup:closePopup,pushPopup:pushPopup,setSize:setSize,title:title,setDefaults:setDefaults}}(jQuery);window.GGBT_gen_msg=function($){const CLASS="msg-box";const DOM_STRING='<div="'+CLASS+'">'+'<div class="message"></div>'+"</div>";var dom=null;function lazyInit(){if(!$("."+CLASS).length){dom=$(DOM_STRING).appendTo("body")}else{dom=$("."+CLASS)}dom.off("click").on("click",function(){dom.hide()})}function setMessage(message){dom.find(".message").text(message)}function animate(){dom.fadeIn(function(){setTimeout(function(){dom.fadeOut()},5e3)})}function msg(message){lazyInit();setMessage(message);animate()}return{msg:msg}}(jQuery);window.GGBT_gen_edit=function($){var SAVE_STATE_READY=0,SAVE_STATE_INPROGRESS=1,SAVE_STATE_SUCCESSFUL=2,SAVE_STATE_ERROR=3,saveState=0,saveFunction,saveButtons,saveAndContinueButtons,saveAndCloseButtons;function setSaveState(state,message,short){var disableButtons=false;$("#save-info-inprogress").hide();$("#save-info-successful").hide();$("#save-info-error").hide();if(state===SAVE_STATE_INPROGRESS){disableButtons=true;$("#save-info-inprogress").show()}else if(state===SAVE_STATE_SUCCESSFUL){if(message!==undefined){if($("#save-info-successful .message").length){$("#save-info-successful .message").text(message)}else{$("#save-info-successful").text(message)}}if(short===undefined||!short){$("#save-info-successful").show();setTimeout(function(){$("#save-info-successful").hide()},5e3)}}else if(state===SAVE_STATE_ERROR){if($("#save-info-error .message").length){$("#save-info-error .message").text(message)}else{$("#save-info-error").text(message)}$("#save-info-error").show()}saveState=state;if(disableButtons){$(saveAndContinueButtons).attr("disabled","disabled");$(saveButtons).attr("disabled","disabled")}else{$(saveAndContinueButtons).removeAttr("disabled");$(saveButtons).removeAttr("disabled")}}function getDoneURL(){var doneUrl=$(saveAndCloseButtons).data("doneurl");if(!doneUrl){doneUrl=$(saveButtons).data("doneurl");if(!doneUrl){doneUrl=$(".save-wrapper").data("doneurl");if(!doneUrl){if(window.location.href.indexOf("doneurl")>=0){var arr=window.location.href.split("/");for(var i=0;i<arr.length;++i){if(arr[i].indexOf("doneurl")>=0){if(arr[i].length===7){doneUrl=decodeURIComponent(arr[i+1]).replace(/%2F/g,"/");doneUrl=doneUrl.substring(0,doneUrl.indexOf("#"));break}else{var queryString=arr[i].split("?");arr=queryString[1].split("&");for(var j=0;j<arr.length;++j){var tmp=arr[j].split("=");if(tmp.length>=1&&tmp[0].indexOf("doneurl")>=0){doneUrl=decodeURIComponent(tmp[1]).replace(/%2F/g,"/");doneUrl=doneUrl.substring(0,doneUrl.indexOf("#"));break}}}}}}}}}return doneUrl}function setDoneURL(doneURL){$(saveButtons).data("doneurl",doneURL)}function initWsfSaveAndContinue(saveFunction,button){saveAndContinueButtons=$(saveAndContinueButtons).add(button);button.on("click",function(e){if(saveState!==SAVE_STATE_INPROGRESS){saveFunction(e,$(this))}})}function initSaveAndClose(saveFunction,button){saveAndCloseButtons=$(saveAndCloseButtons).add(button);button.on("click",function(e){if(saveState!==SAVE_STATE_INPROGRESS){saveFunction(e)}})}function initShareOptionsButtons(buttons){
buttons.off("click").on("click",function(e){e.preventDefault();window.GGBT_clb_shareoptions.showSharoptionsPopup($(this),function(modified){if(modified){location.reload(true)}})})}function initSaveButton(saveFunction,button){saveButtons=$(saveButtons).add(button);$(button).on("click",function(e){var sender=$(this);e.preventDefault();if(saveState!==SAVE_STATE_INPROGRESS){saveFunction(e,sender)}})}function initSave(saveFunction,button){initSaveButton(saveFunction,button)}function setSaveStateSuccessful(msg,short){setSaveState(SAVE_STATE_SUCCESSFUL,msg,short)}function setSaveStateError(msg){setSaveState(SAVE_STATE_ERROR,msg)}function setSaveStateInProgress(){setSaveState(SAVE_STATE_INPROGRESS)}function getSaveState(){return saveState}function setSaveFunction(func){saveFunction=func}function autoSave(data,callback){if(typeof saveFunction==="function"){saveFunction(data,callback)}}function getSaveFunction(){return saveFunction}return{initSave:initSave,initSaveAndClose:initSaveAndClose,initSaveAndContinue:initWsfSaveAndContinue,setSaveState:setSaveState,setDoneURL:setDoneURL,getDoneURL:getDoneURL,setSaveStateSuccessful:setSaveStateSuccessful,setSaveStateError:setSaveStateError,setSaveStateInProgress:setSaveStateInProgress,setSaveFunction:setSaveFunction,getSaveState:getSaveState,autoSave:autoSave,getSave:getSaveFunction,initShareOptionsButtons:initShareOptionsButtons,SAVE_STATE_INPROGRESS:SAVE_STATE_INPROGRESS}}(jQuery);function confirmLogin(formId){if(confirm(login_confirm)){$("#"+formId).submit()}}